<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Product details • Stuffy</title>
<style>
  :root{
    --bg:#f6f7fb; --ink:#171717; --muted:#6b7280;
    --ring:#e6e8ef; --primary:#6f2cff; --primary-2:#5b22d1; --danger:#d92d20;
    --ok:#0f766e; --card:#fff; --shadow:0 10px 30px rgba(0,0,0,.06);
    --radius:20px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}

  .shell{min-height:100dvh;display:flex;flex-direction:column;padding:16px}
  .topbar{display:flex;align-items:center;gap:12px;padding:8px 6px}
  .back{width:42px;height:42px;border-radius:999px;background:#fff;display:grid;place-items:center;border:1px solid var(--ring);box-shadow:0 1px 2px rgba(0,0,0,.04);cursor:pointer}
  .back svg{width:18px;height:18px}
  .title{margin:0 auto;font-size:24px;font-weight:700}

  .panel{width:min(820px,96vw);margin:6px auto 18px;background:var(--card);border:1px solid var(--ring);border-radius:var(--radius);box-shadow:var(--shadow);padding:clamp(16px,4vw,28px)}
  .section-label{color:var(--ink);font-weight:600;margin:8px 0 8px}

  /* image picker */
  .img-wrap{display:flex;flex-direction:column;align-items:center;gap:10px}
  .img-box{
    width:180px;height:180px;border:2px dashed #ddd;border-radius:14px;display:grid;place-items:center;background:#fafafa;position:relative;overflow:hidden;
  }
  .img-box svg{width:46px;height:46px;color:#6b7280}
  .img-box.has-img{border-style:solid;background:#fff}
  .img-box img{width:100%;height:100%;object-fit:cover;display:none}
  .img-box.has-img img{display:block}
  .remove-img{
    display:none;position:absolute;right:6px;top:6px;width:32px;height:32px;border-radius:999px;
    background:#fff;border:1px solid var(--ring);box-shadow:0 1px 2px rgba(0,0,0,.06);cursor:pointer
  }
  .img-box.has-img .remove-img{display:grid;place-items:center}
  .choose{border:1px solid var(--ring);background:#fff;border-radius:10px;padding:10px 14px;cursor:pointer}

  /* form */
  form{width:100%;max-width:760px;margin:14px auto 0}
  .field{margin:12px 0}
  label{display:block;font-weight:600;margin:6px 0 8px}
  .input{
    width:100%;border:1px solid var(--ring);background:#fff;color:var(--ink);
    border-radius:16px;padding:16px 14px;font-size:16px;outline:none;transition:border-color .15s, box-shadow .15s;
  }
  .input::placeholder{color:#b7bfcc}
  .input:focus{border-color:#c9cff5;box-shadow:0 0 0 4px rgba(111,44,255,.10)}
  .row{display:grid;grid-template-columns:1fr;gap:12px}
  @media(min-width:640px){ .row{grid-template-columns:1fr 1fr} }

  .err{color:var(--danger);font-size:13px;margin-top:6px;min-height:1em}

  .actions{display:grid;gap:12px;margin:22px 0}
  .btn{border:1px solid transparent;border-radius:18px;padding:16px 18px;font-weight:700;font-size:16px;cursor:pointer}
  .btn-primary{background:var(--primary);color:#fff}
  .btn-primary:hover{background:var(--primary-2)}
  .btn-ghost{background:#fff;border:1px solid var(--ring)}
  .btn-ghost:hover{background:#fafafa}

  /* toast */
  .toast{
    position:fixed;left:16px;right:16px;top:16px;margin:auto;max-width:720px;
    background:#ecfdf5;border:1px solid #c8f5e8;border-radius:14px;box-shadow:0 10px 24px rgba(0,0,0,.08);
    display:flex;align-items:center;gap:14px;padding:16px 18px;z-index:50;opacity:0;transform:translateY(-12px);pointer-events:none;
  }
  .toast.show{opacity:1;transform:none;transition:.35s cubic-bezier(.22,.98,.2,1)}
  .toast .check{width:28px;height:28px;background:#065f46;border-radius:999px;display:grid;place-items:center}
  .toast .check svg{width:18px;height:18px;color:#fff}
  .toast .title{font-size:18px;margin:0}
  .toast .sub{margin:2px 0 0;color:#374151}

</style>


</head>
<body>
<!-- Bootstrap 5 (CDN) -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<style>
  :root{
    --sb-w: 264px;
    --sb-bg: #ffffff;
    --sb-ring: #e6e8ef;
  }

  /* Only push content when the sidebar is open on desktop */
  @media (min-width: 992px){
    body.sidebar-open{ margin-left: var(--sb-w); transition: margin-left .28s cubic-bezier(.22,.98,.2,1); }
  }

  /* Sidebar size */
  #appSidebar{
    width: var(--sb-w);
    background: var(--sb-bg);
    border-right: 1px solid var(--sb-ring);
  }
  @media (max-width: 991.98px){
    #appSidebar{ width: min(86vw, 320px); }
  }

  /* Hide Bootstrap backdrop on desktop (we push the layout instead) */
  @media (min-width: 992px){
    .offcanvas-backdrop{ display:none !important; }
  }

  /* Hamburger launcher (show on ALL sizes so desktop can toggle too) */
  #sbToggle{
    position: fixed; left: 12px; top: 12px; z-index: 1056;
    border: 1px solid var(--sb-ring);
    box-shadow: 0 8px 20px rgba(0,0,0,.08);
  }

  /* Small visual polish */
  .sb-brand{
    display:flex; align-items:center; gap:10px; font-weight:900;
  }
  .sb-logo{
    width:36px; height:36px; border-radius:10px; background:#6f2cff; color:#fff;
    display:grid; place-items:center;
  }
  .sb-user{ border:1px solid var(--sb-ring); }
  .sb-badge{ font-weight:700; border:1px solid var(--sb-ring); }
</style>

<!-- Toggle button (works on mobile & desktop) -->
<button id="sbToggle" class="btn btn-light" type="button"
        data-bs-toggle="offcanvas" data-bs-target="#appSidebar" aria-controls="appSidebar" aria-label="Open menu">
  <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <path d="M4 6h16M4 12h16M4 18h16" stroke-linecap="round"/>
  </svg>
</button>

<!-- Sidebar -->
<div id="appSidebar"
     class="offcanvas offcanvas-start"
     data-bs-scroll="true" data-bs-backdrop="true" tabindex="-1" aria-labelledby="appSidebarLabel">

  <div class="offcanvas-header border-bottom">
    <div class="sb-brand">
      <div class="fs-5"></div>
    </div>
    <!-- Show the close button on ALL sizes so desktop can close too -->
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>

  <div class="offcanvas-body d-flex flex-column pt-3 pb-3">
    <!-- Quick search (routes to Inventory) -->
    <div class="input-group mb-3">
      <span class="input-group-text bg-white border-end-0">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.3-4.3"/></svg>
      </span>
      <input id="sbSearch" type="search" class="form-control border-start-0" placeholder="Quick search products…">
    </div>

    <!-- Nav -->
    <ul class="nav nav-pills flex-column gap-1 mb-3" id="sbNav">
      <li class="nav-item">
        <a class="nav-link d-flex align-items-center gap-2" href="dashboard.html" data-link>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3v18h18"/><path d="M7 13l3 3 7-7"/></svg>
          <span>Dashboard</span>
        </a>
      </li>

      <li class="nav-item">
        <a class="nav-link d-flex align-items-center justify-content-between" href="products.html" data-link>
          <span class="d-flex align-items-center gap-2">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
            Inventory
          </span>
          <span id="sbLow" class="badge rounded-pill sb-badge text-bg-warning-subtle d-none">0 low</span>
        </a>
      </li>

      <li class="nav-item">
        <a class="nav-link d-flex align-items-center gap-2" href="make_sale.html" data-link>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 6h15l-1 7H7z"/><circle cx="9" cy="20" r="1"/><circle cx="18" cy="20" r="1"/></svg>
          <span>Make sale</span>
        </a>
      </li>

      <li class="nav-item">
        <a class="nav-link d-flex align-items-center gap-2" href="sales_history.html" data-link>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3v18h18"/><path d="M7 13l3 3 7-7"/></svg>
          <span>Sales history</span>
        </a>
      </li>

      <li class="nav-item">
        <a class="nav-link d-flex align-items-center justify-content-between" href="notifications.html" data-link>
          <span class="d-flex align-items-center gap-2">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8a6 6 0 10-12 0c0 7-3 7-3 7h18s-3 0-3-7"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>
            Notifications
          </span>
          <span id="sbNotif" class="badge rounded-pill sb-badge text-bg-info-subtle d-none">0</span>
        </a>
      </li>

      <li><hr class="dropdown-divider my-2"></li>

      <li class="nav-item">
        <a class="nav-link d-flex align-items-center gap-2" href="settings.html" data-link>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 11-2.83 2.83l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V22a2 2 0 11-4 0v-.09a1.65 1.65 0 00-1-1.51 1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 11-2.83-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H2a2 2 0 110-4h.09a1.65 1.65 0 001.51-1z"/></svg>
          <span>Settings</span>
        </a>
      </li>

      <li class="nav-item">
        <a class="nav-link d-flex align-items-center gap-2" href="help.html" data-link>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.82 1c0 2-3 2-3 4"/><path d="M12 17h.01"/></svg>
          <span>Help & support</span>
        </a>
      </li>
    </ul>

    <!-- User box -->
    <div class="card sb-user mt-auto">
      <div class="card-body d-flex align-items-center gap-2">
        <div id="sbAvatar" class="rounded-3 bg-primary-subtle text-primary-emphasis fw-bold d-inline-grid place-items-center"
             style="width:38px;height:38px;">S</div>
        <div class="flex-grow-1">
          <div id="sbUname" class="fw-bold">—</div>
          <div id="sbUemail" class="text-muted small">—</div>
        </div>
        <button id="sbLogout" class="btn btn-outline-secondary btn-sm">Log out</button>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  // Keys used across the app
  const CURRENT_KEY  = 'stockly_current_user';
  const PRODUCTS_KEY = 'stockly_products_v1';
  const NOTIFS_KEY   = 'stockly_notifs_v1';

  const ocEl = document.getElementById('appSidebar');

  // When the offcanvas opens/closes, toggle a class on <body> (desktop layout push)
  ocEl.addEventListener('shown.bs.offcanvas', ()=> document.body.classList.add('sidebar-open'));
  ocEl.addEventListener('hidden.bs.offcanvas', ()=> document.body.classList.remove('sidebar-open'));

  // Highlight active link
  const current = (location.pathname.split('/').pop() || 'dashboard.html').toLowerCase();
  document.querySelectorAll('#appSidebar a[data-link]').forEach(a=>{
    if ((a.getAttribute('href')||'').toLowerCase() === current) a.classList.add('active');
  });

  // Fill user box
  let user=null; try{ user = JSON.parse(localStorage.getItem(CURRENT_KEY)||'null'); }catch(e){}
  const uname = document.getElementById('sbUname');
  const uemail= document.getElementById('sbUemail');
  const avatar= document.getElementById('sbAvatar');
  if(user && user.name){
    uname.textContent = user.name;
    uemail.textContent = user.email || '';
    avatar.textContent = (user.name[0]||'S').toUpperCase();
  }else{
    uname.textContent = 'Guest'; uemail.textContent = 'Not signed in'; avatar.textContent='S';
  }

  // Badges: low/out & notifications
  (function updateBadges(){
    const lowEl = document.getElementById('sbLow');
    const notifEl = document.getElementById('sbNotif');

    let low=0, out=0;
    try{
      const prods = JSON.parse(localStorage.getItem(PRODUCTS_KEY)||'[]');
      const mine  = user?.id ? prods.filter(p=>p.ownerId===user.id) : prods;
      for(const p of mine){
        const q = Number(p.qty)||0;
        if(q===0) out++; else if(q<=4) low++;
      }
    }catch(e){}
    if(low>0 || out>0){
      lowEl.classList.remove('d-none');
      lowEl.textContent = `${low} low${out?`, ${out} out`:''}`;
      if(out>0){ lowEl.classList.add('text-bg-danger-subtle'); }
    }

    let count=0;
    try{
      const ns = JSON.parse(localStorage.getItem(NOTIFS_KEY)||'[]');
      const since = Date.now() - 30*86400000;
      count = ns.filter(n => (!user?.id || n.ownerId===user.id) && (n.createdAtMs||0) >= since).length;
    }catch(e){}
    if(count>0){
      notifEl.classList.remove('d-none');
      notifEl.textContent = String(count);
    }
  })();

  // Quick search → Inventory page
  document.getElementById('sbSearch')?.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter'){
      const q = (e.currentTarget.value || '').trim();
      location.href = q ? ('products.html#q=' + encodeURIComponent(q)) : 'products.html';
      const oc = bootstrap.Offcanvas.getInstance(ocEl);
      oc?.hide();
    }
  });

  // Logout
  document.getElementById('sbLogout')?.addEventListener('click', ()=>{
    localStorage.removeItem(CURRENT_KEY);
    location.href = 'login.html';
  });
})();
</script>


  <div class="shell">
    <header class="topbar">
      
      <h1 class="title">Product details</h1>
      <span style="width:42px"></span>
    </header>

    <section class="panel">
      <div class="section-label">Product image (optional)</div>
      <div class="img-wrap">
        <div id="imgBox" class="img-box" aria-live="polite">
          <svg id="imgIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <circle cx="8.5" cy="8.5" r="1.5"></circle>
            <path d="M21 15l-5-5L5 21"></path>
          </svg>
          <img id="preview" alt="Selected product image preview" />
          <button id="removeImg" class="remove-img" type="button" aria-label="Remove image">
            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M6 6l12 12M18 6L6 18" stroke-linecap="round"/>
            </svg>
          </button>
        </div>
        <input id="file" type="file" accept="image/*" hidden />
        <button id="chooseBtn" class="choose" type="button">Choose image</button>
      </div>

      <form id="form" novalidate>
        <div class="field">
          <label for="name">Product name</label>
          <input id="name" class="input" type="text" placeholder="e.g. Office wear" required />
          <div id="err-name" class="err"></div>
        </div>

        <div class="row">
          <div class="field">
            <label for="qty">Quantity</label>
            <input id="qty" class="input" type="number" inputmode="numeric" placeholder="100" min="0" step="1" required />
            <div id="err-qty" class="err"></div>
          </div>

          <div class="field">
            <label for="price">Price</label>
            <input id="price" class="input" type="number" inputmode="decimal" placeholder="₵ 150.00" min="0" step="0.01" required />
            <div id="err-price" class="err"></div>
          </div>
        </div>

        <div class="actions">
          <button class="btn btn-primary" type="submit">Add product</button>
          <button class="btn btn-ghost" type="button" onclick="goProducts()">Cancel</button>
        </div>
      </form>
    </section>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true">
    <div class="check"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
    <div>
      <h3 class="title" id="toastTitle">Product Added</h3>
      <div class="sub" id="toastMsg">Item has been added to your inventory</div>
    </div>
  </div>

<script>
  // ===== Keys & guards =====
  const CURRENT_KEY  = 'stockly_current_user';
  const PRODUCTS_KEY = 'stockly_products_v1';

  function goProducts(){ location.href = 'products.html'; }

  // Require login
  let current = null;
  try { current = JSON.parse(localStorage.getItem(CURRENT_KEY)||'null'); } catch(e){}
  if(!current){ location.href = 'login.html'; }

  // ===== Image picker =====
  const file = document.getElementById('file');
  const chooseBtn = document.getElementById('chooseBtn');
  const imgBox = document.getElementById('imgBox');
  const preview = document.getElementById('preview');
  const imgIcon = document.getElementById('imgIcon');
  const removeImg = document.getElementById('removeImg');
  let imageData = null; // dataURL

  chooseBtn.addEventListener('click', ()=> file.click());
  file.addEventListener('change', () => {
    const f = file.files && file.files[0];
    if(!f) return;
    const reader = new FileReader();
    reader.onload = e => {
      imageData = e.target.result;
      preview.src = imageData;
      imgBox.classList.add('has-img');
    };
    reader.readAsDataURL(f);
  });
  removeImg.addEventListener('click', () => {
    imageData = null;
    preview.src = '';
    imgBox.classList.remove('has-img');
    file.value = '';
  });

  // ===== Helpers =====
  function uid(){ return Math.random().toString(36).slice(2,9)+Date.now().toString(36).slice(-4); }
  function readProducts(){ try { return JSON.parse(localStorage.getItem(PRODUCTS_KEY)) || []; } catch(e){ return []; } }
  function writeProducts(list){ localStorage.setItem(PRODUCTS_KEY, JSON.stringify(list)); }

  function showToast(name){
    const t = document.getElementById('toast');
    document.getElementById('toastMsg').textContent = `${name} has been added to your inventory`;
    t.classList.add('show');
    setTimeout(()=> t.classList.remove('show'), 2500);
  }

  // ===== Form handling =====
  const form = document.getElementById('form');
  const nameEl  = document.getElementById('name');
  const qtyEl   = document.getElementById('qty');
  const priceEl = document.getElementById('price');

  const eName  = document.getElementById('err-name');
  const eQty   = document.getElementById('err-qty');
  const ePrice = document.getElementById('err-price');

  function setErr(el,msg){ el.textContent = msg||''; }
  function clearErrs(){ setErr(eName); setErr(eQty); setErr(ePrice); }

  form.addEventListener('submit', (ev)=>{
    ev.preventDefault();
    clearErrs();

    const name  = (nameEl.value||'').trim();
    const qty   = Number(qtyEl.value);
    const price = Number(priceEl.value);

    let ok = true;
    if(name.length < 2){ setErr(eName,'Please enter a product name.'); ok = false; }
    if(!Number.isFinite(qty) || qty < 0){ setErr(eQty,'Enter a valid quantity (0 or more).'); ok = false; }
    if(!Number.isFinite(price) || price < 0){ setErr(ePrice,'Enter a valid price (0 or more).'); ok = false; }
    if(!ok) return;

    const now = new Date();
    const product = {
      id: uid(),
      ownerId: current?.id || null,
      name,
      qty,
      price,                 // store as number
      image: imageData,      // dataURL or null
      createdAt: now.toISOString(),
      createdAtMs: now.getTime()
    };

    const list = readProducts();
    list.unshift(product);  // newest first
    writeProducts(list);

    // Success UI: toast + reset form like your mock
    showToast(name);
    form.reset();
    removeImg.click(); // clears image preview if any
  });
</script>

</body>
</html>
