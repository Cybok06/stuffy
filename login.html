<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Login • Stockly</title>
  <style>
    :root{
      --bg:#f6f7fb; --ink:#171717; --muted:#6b7280; --ring:#e6e8ef;
      --primary:#6f2cff; --primary-2:#5b22d1; --danger:#d92d20;
      --card:#ffffff; --shadow:0 10px 30px rgba(0,0,0,.06); --radius:20px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; background:var(--bg); color:var(--ink); font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
    .shell{min-height:100dvh; display:grid; place-items:center; padding:24px}
    .panel{width:min(820px,96vw); background:var(--card); border:1px solid var(--ring); border-radius:var(--radius); box-shadow:var(--shadow); padding:clamp(20px,4vw,44px); display:grid; row-gap:10px}
    .topbar{ display:flex; align-items:center; gap:12px }
    .back{width:42px;height:42px;border-radius:999px;background:#fff;display:grid;place-items:center;border:1px solid var(--ring);box-shadow:0 1px 2px rgba(0,0,0,.04);cursor:pointer}
    .back svg{width:18px;height:18px}
    .title{font-size:clamp(28px,3.4vw,40px); line-height:1.12; font-weight:800; margin:10px 0 6px}
    .lead{color:#4b5563; font-size:clamp(15px,1.6vw,17px); line-height:1.55; margin:0 0 8px; max-width:60ch}
    form{ width:100%; max-width:640px }
    .field{ margin:14px 0 }
    label{ display:block; font-weight:600; margin:6px 0 8px }
    .input{ width:100%; border:1px solid var(--ring); background:#fff; color:var(--ink); border-radius:16px; padding:16px 14px; font-size:16px; outline:none; transition:border-color .15s ease, box-shadow .15s ease }
    .input::placeholder{ color:#b7bfcc }
    .input:focus{ border-color:#c9cff5; box-shadow:0 0 0 4px rgba(111,44,255,.10) }
    .pw-wrap{ position:relative }
    .pw-toggle{ position:absolute; right:12px; top:50%; transform:translateY(-50%); width:36px; height:36px; display:grid; place-items:center; border-radius:10px; border:1px solid transparent; background:transparent; cursor:pointer }
    .pw-toggle:hover{ background:#fafafa; border-color:var(--ring) }
    .pw-toggle svg{ width:20px; height:20px; color:#666 }
    .error{ color:var(--danger); font-size:13px; margin-top:6px; min-height:1em }
    .error-global{ color:var(--danger); font-weight:700; margin-top:4px; min-height:1.2em }
    .btn{ border:1px solid transparent; border-radius:20px; padding:16px 18px; font-weight:700; font-size:16px; width:100%; text-align:center; cursor:pointer; box-shadow:var(--shadow) }
    .btn-primary{ background:var(--primary); color:#fff }
    .btn-primary:hover{ background:var(--primary-2) }
    .btn-primary:disabled{ opacity:.6; cursor:not-allowed }
    .foot-note{ text-align:center; color:#747b86; margin-top:12px }
    .foot-note a{ color:#5d34ff; text-decoration:none }
    .foot-note a:hover{ text-decoration:underline }
    .reveal{ opacity:0; transform:translateX(-36px) }
    .loaded .reveal{ animation:slideIn .6s cubic-bezier(.22,.98,.2,1) forwards }
    .reveal.d1{ animation-delay:.05s } .reveal.d2{ animation-delay:.12s } .reveal.d3{ animation-delay:.18s } .reveal.d4{ animation-delay:.24s }
    @keyframes slideIn{ to{ opacity:1; transform:none } }
    @media (prefers-reduced-motion: reduce){ .reveal{ opacity:1; transform:none } .loaded .reveal{ animation:none } }
  </style>
</head>
<body>
  <div class="shell">
    <section class="panel">
      <div class="topbar">
        <button class="back reveal" type="button" aria-label="Back" onclick="history.back()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
      </div>

      <h1 class="title reveal d1">Login to your account</h1>
      <p class="lead reveal d2">Log in to securely manage inventory and sales — works offline on this device.</p>

      <div id="err-global" class="error-global reveal d2"></div>

      <form id="form" novalidate class="reveal d3" autocomplete="on">
        <div class="field">
          <label for="email">Email</label>
          <input class="input" id="email" name="email" type="email" placeholder="john@example.com" required />
          <div class="error" id="err-email"></div>
        </div>

        <div class="field">
          <label for="password">Password</label>
          <div class="pw-wrap">
            <input class="input" id="password" name="password" type="password" placeholder="Your password" minlength="6" required />
            <button type="button" class="pw-toggle" id="togglePw" aria-label="Show password">
              <svg id="eyeOpen" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7z"/><circle cx="12" cy="12" r="3"/></svg>
              <svg id="eyeClosed" style="display:none" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17.94 17.94A10.94 10.94 0 0 1 12 20c-7 0-11-8-11-8a21.77 21.77 0 0 1 5.06-6.94M1 1l22 22"/></svg>
            </button>
          </div>
          <div class="error" id="err-password"></div>
        </div>

        <button id="submitBtn" class="btn btn-primary" type="submit">Sign in</button>
      </form>

      <div class="foot-note reveal d4">
        Don’t have an account? <a href="create_account.html">Create one</a>
      </div>
    </section>
  </div>

  <script>
    // Keys & destination
    const USERS_KEY = 'stockly_users_v1';
    const CURRENT_KEY = 'stockly_current_user';
    const DASHBOARD_URL = 'dashboard.html';

    // Entrance animation + already-logged-in shortcut
    document.addEventListener('DOMContentLoaded', () => {
      requestAnimationFrame(() => document.body.classList.add('loaded'));
      try {
        const current = JSON.parse(localStorage.getItem(CURRENT_KEY) || 'null');
        if (current && current.name) location.href = DASHBOARD_URL;
      } catch (e) {}
    });

    function readUsers(){ try { return JSON.parse(localStorage.getItem(USERS_KEY)) || []; } catch(e){ return []; } }
    function setCurrent(user){
      localStorage.setItem(CURRENT_KEY, JSON.stringify({ id:user.id, name:user.name, email:user.email }));
    }

    async function sha256(text){
      const enc = new TextEncoder().encode(text);
      const buf = await crypto.subtle.digest('SHA-256', enc);
      return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
    }

    // UI refs
    const form = document.getElementById('form');
    const emailEl = document.getElementById('email');
    const pwEl = document.getElementById('password');
    const submitBtn = document.getElementById('submitBtn');
    const errEmail = document.getElementById('err-email');
    const errPw = document.getElementById('err-password');
    const errGlobal = document.getElementById('err-global');

    // Password visibility
    const toggle = document.getElementById('togglePw');
    const eyeOpen = document.getElementById('eyeOpen');
    const eyeClosed = document.getElementById('eyeClosed');
    toggle.addEventListener('click', () => {
      const show = pwEl.type === 'password';
      pwEl.type = show ? 'text' : 'password';
      eyeOpen.style.display = show ? 'none' : '';
      eyeClosed.style.display = show ? '' : 'none';
      toggle.setAttribute('aria-label', show ? 'Hide password' : 'Show password');
    });

    function setError(el, msg){ el.textContent = msg || ''; }
    function clearErrors(){ setError(errGlobal); setError(errEmail); setError(errPw); }
    function validEmail(v){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v); }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      clearErrors();

      const email = (emailEl.value || '').trim().toLowerCase();
      const password = pwEl.value || '';

      let ok = true;
      if(!validEmail(email)){ setError(errEmail, 'Enter a valid email.'); ok = false; }
      if(password.length < 6){ setError(errPw, 'Password must be at least 6 characters.'); ok = false; }
      if(!ok) return;

      const users = readUsers();
      if(!users.length){
        setError(errGlobal, 'No accounts found on this device. Please create one first.');
        return;
      }

      const user = users.find(u => u.email === email);
      if(!user){
        setError(errGlobal, 'Account not found. Check your email or create an account.');
        return;
      }

      submitBtn.disabled = true;
      try{
        const hash = await sha256(password);
        if(hash !== user.pw){
          setError(errGlobal, 'Incorrect password. Please try again.');
          submitBtn.disabled = false;
          return;
        }
        setCurrent(user);
        location.href = DASHBOARD_URL;
      }catch(err){
        setError(errGlobal, 'Sign-in failed (browser crypto not available?).');
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
