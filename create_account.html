<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Create account â€¢ Stuffy</title>
  <style>
    :root{
      --bg:#f6f7fb; --ink:#171717; --muted:#6b7280;
      --ring:#e6e8ef; --primary:#6f2cff; --primary-2:#5b22d1;
      --danger:#d92d20; --card:#ffffff; --shadow:0 10px 30px rgba(0,0,0,.06);
      --radius:20px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; background:var(--bg); color:var(--ink); font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;}

    .shell{min-height:100dvh; display:grid; place-items:center; padding:24px;}
    .panel{
      width:min(820px,96vw); background:var(--card); border:1px solid var(--ring);
      border-radius:var(--radius); box-shadow:var(--shadow);
      padding:clamp(20px,4vw,44px); display:grid; row-gap:10px;
    }
    .topbar{display:flex; align-items:center; gap:12px}
    .back{width:42px;height:42px;border-radius:999px;background:#fff;display:grid;place-items:center;border:1px solid var(--ring);box-shadow:0 1px 2px rgba(0,0,0,.04);cursor:pointer}
    .back svg{width:18px;height:18px}

    .title{font-size:clamp(28px,3.4vw,40px); line-height:1.12; font-weight:800; margin:10px 0 6px}
    .lead{color:var(--muted); font-size:clamp(15px,1.6vw,17px); line-height:1.55; margin:0 0 10px; max-width:58ch}

    form{width:100%; max-width:640px}
    .field{margin:14px 0}
    label{display:block; font-weight:600; margin:6px 0 8px}
    .input{
      width:100%; border:1px solid var(--ring); background:#fff; color:var(--ink);
      border-radius:16px; padding:16px 14px; font-size:16px; outline:none;
      transition:border-color .15s ease, box-shadow .15s ease;
    }
    .input::placeholder{color:#b7bfcc}
    .input:focus{border-color:#c9cff5; box-shadow:0 0 0 4px rgba(111,44,255,.10)}

    .pw-wrap{position:relative}
    .pw-toggle{position:absolute; right:12px; top:50%; transform:translateY(-50%); width:36px; height:36px; display:grid; place-items:center; border-radius:10px; border:1px solid transparent; background:transparent; cursor:pointer}
    .pw-toggle:hover{background:#fafafa; border-color:var(--ring)}
    .pw-toggle svg{width:20px; height:20px; color:#666}

    .error{color:var(--danger); font-size:13px; margin-top:6px; min-height:1em}

    .btn{border:1px solid transparent; border-radius:20px; padding:16px 18px; font-weight:700; font-size:16px; width:100%; text-align:center; cursor:pointer; box-shadow:var(--shadow)}
    .btn-primary{background:var(--primary); color:#fff}
    .btn-primary:hover{background:var(--primary-2)}
    .btn-primary:disabled{opacity:.6; cursor:not-allowed}

    /* Slide-in polish */
    .reveal{opacity:0; transform:translateX(-36px)}
    .loaded .reveal{animation:slideIn .6s cubic-bezier(.22,.98,.2,1) forwards}
    .reveal.d1{animation-delay:.05s} .reveal.d2{animation-delay:.12s} .reveal.d3{animation-delay:.18s}
    @keyframes slideIn{to{opacity:1; transform:none}}
    @media (prefers-reduced-motion:reduce){.reveal{opacity:1; transform:none} .loaded .reveal{animation:none}}
  </style>
</head>
<body>
  <div class="shell">
    <section class="panel">
      <div class="topbar">
        <button class="back reveal" type="button" aria-label="Back" onclick="history.back()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
      </div>

      <h1 class="title reveal d1">Create an account</h1>
      <p class="lead reveal d2">Create your account to access Stuffy's offline inventory & sales.</p>

      <form id="form" novalidate class="reveal d3" autocomplete="on">
        <div class="field">
          <label for="name">Name</label>
          <input class="input" id="name" name="name" type="text" placeholder="John Doe" required />
          <div class="error" id="err-name"></div>
        </div>

        <div class="field">
          <label for="email">Email</label>
          <input class="input" id="email" name="email" type="email" placeholder="john@example.com" required />
          <div class="error" id="err-email"></div>
        </div>

        <div class="field">
          <label for="password">Password</label>
          <div class="pw-wrap">
            <input class="input" id="password" name="password" type="password" placeholder="Minimum 6 characters" minlength="6" required />
            <button type="button" class="pw-toggle" id="togglePw" aria-label="Show password">
              <svg id="eyeOpen" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7z"/><circle cx="12" cy="12" r="3"/></svg>
              <svg id="eyeClosed" style="display:none" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17.94 17.94A10.94 10.94 0 0 1 12 20c-7 0-11-8-11-8a21.77 21.77 0 0 1 5.06-6.94M1 1l22 22"/></svg>
            </button>
          </div>
          <div class="error" id="err-password"></div>
        </div>

        <button id="submitBtn" class="btn btn-primary" type="submit">Create account</button>
      </form>

      <div class="foot-note reveal d3">Already have an account? <a href="login.html">Login</a></div>
    </section>
  </div>

  <script>
    // Entrance animation
    document.addEventListener('DOMContentLoaded', () => {
      requestAnimationFrame(() => document.body.classList.add('loaded'));
    });

    // ===== LocalStorage "Auth" (offline) =====
    const USERS_KEY   = 'stockly_users_v1';
    const CURRENT_KEY = 'stockly_current_user';     // not set on signup; kept for login
    const SIGNUP_NAME = 'stockly_last_signup_name'; // passed to success page

    function readUsers(){ try { return JSON.parse(localStorage.getItem(USERS_KEY)) || []; } catch(e){ return []; } }
    function writeUsers(list){ localStorage.setItem(USERS_KEY, JSON.stringify(list)); }
    function uid(){ return Math.random().toString(36).slice(2,9)+Date.now().toString(36).slice(-4); }

    async function sha256(text){
      const enc = new TextEncoder().encode(text);
      const buf = await crypto.subtle.digest('SHA-256', enc);
      return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
    }

    // UI refs
    const f = document.getElementById('form');
    const submitBtn = document.getElementById('submitBtn');
    const errName = document.getElementById('err-name');
    const errEmail = document.getElementById('err-email');
    const errPw = document.getElementById('err-password');

    // Password visibility
    const pw = document.getElementById('password');
    const toggle = document.getElementById('togglePw');
    const eyeOpen = document.getElementById('eyeOpen');
    const eyeClosed = document.getElementById('eyeClosed');
    toggle.addEventListener('click', () => {
      const show = pw.type === 'password';
      pw.type = show ? 'text' : 'password';
      eyeOpen.style.display = show ? 'none' : '';
      eyeClosed.style.display = show ? '' : 'none';
      toggle.setAttribute('aria-label', show ? 'Hide password' : 'Show password');
    });

    function setError(el, msg){ el.textContent = msg || ''; }
    function clearErrors(){ setError(errName); setError(errEmail); setError(errPw); }
    function validEmail(v){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v); }

    f.addEventListener('submit', async (e) => {
      e.preventDefault();
      clearErrors();

      const name = (document.getElementById('name').value || '').trim();
      const email = (document.getElementById('email').value || '').trim().toLowerCase();
      const password = document.getElementById('password').value || '';

      let ok = true;
      if(name.length < 2){ setError(errName, 'Please enter your full name.'); ok = false; }
      if(!validEmail(email)){ setError(errEmail, 'Enter a valid email.'); ok = false; }
      if(password.length < 6){ setError(errPw, 'Password must be at least 6 characters.'); ok = false; }
      if(!ok) return;

      const users = readUsers();
      if(users.some(u => u.email === email)){
        setError(errEmail, 'Email already registered.');
        return;
      }

      submitBtn.disabled = true;

      try{
        const hash = await sha256(password);
        const user = { id: uid(), name, email, pw: hash, createdAt: new Date().toISOString() };
        users.push(user);
        writeUsers(users);

        // Keep user logged out (they'll login next). Pass name to success page.
        try { localStorage.setItem(SIGNUP_NAME, name); } catch (e) {}
        // Optional: clear any current user
        localStorage.removeItem(CURRENT_KEY);

        // Go to success page
        location.href = 'signup_success.html';
      }catch(err){
        alert('Could not create account (browser crypto not available?).');
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
